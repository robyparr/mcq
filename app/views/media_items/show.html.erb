<h2 class="page-header" title="<%= @media_item.url %>">
  <%= @media_item.title_or_url %>
</h1>

<div class="toolbar text-muted -mt-4">
  <div class="media-item">
    <i class="fas fa-inbox"></i>
    <%= link_to @media_item.queue.name, queue_path(@media_item.queue), class: 'text-muted' %>
  </div>

  <% if @media_item.estimated_consumption_time %>
    <div class="media-item">
      <i class="far fa-clock"></i>
      <%= pluralize @media_item.estimated_consumption_time, 'minute' %>
    </div>
  <% end %>

  <% if @media_item.priority %>
    <span class="font-bold">
      <%= @media_item.priority.title %>
    </span>
  <% end %>

  <% if @media_item.consumption_difficulty %>
    <%= render 'consumption_difficulty', consumption_difficulty: @media_item.consumption_difficulty %>
  <% end %>
</div>

<div class="toolbar mt-4">
  <%= link_to 'Edit', edit_media_item_path(@media_item), class: 'button' %>
  <%= link_to 'Open Media', @media_item.url, class: 'button' %>
  <%= button_tag 'Open Viewer', class: 'button', data: { url_viewer: '#url-viewer' } %>

  <% unless @media_item.complete? %>
    <%= button_to 'Mark Completed', complete_media_item_url(@media_item),
      class: 'button',
      method: :post %>
  <% end %>
</div>

<h3 class="section-header">Notes</h3>

<div class="row">
  <div id="notes" class="column md4 pl-0">
    <%= form_with scope: :media_note,
                  url: media_item_notes_path(@media_item, format: :js) do |f| %>
      <%= f.text_field :title, placeholder: 'Title...' %>
      <rich-editor></rich-editor>
      <%= f.submit class: 'button' %>
    <% end %>

    <% if @media_item.notes.any? %>
      <% @media_item.notes.each do |note| %>
        <div id="note-<%= note.id %>" class="row mt-4">
          <div class="column md12 pl-0">
            <%= render 'media_notes/note', note: note %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

<div id="url-viewer" style="width: 0;">
  <url-viewer url="<%= @media_item.url %>"></url-viewer>
</div>

<%= javascript_pack_tag 'url_viewer' %>
<%= stylesheet_pack_tag 'url_viewer' %>

<%= javascript_pack_tag 'rich_editor' %>

<script>
  document.querySelector('[data-url-viewer]').addEventListener('click', function(e) {
    var viewerSelector = e.target.dataset.urlViewer;
    var viewer         = document.querySelector(viewerSelector);

    viewer.style.width = '50%';
  });

  renderRichEditor('#notes');
</script>
