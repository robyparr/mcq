<div data-controller="media-viewer"
     data-media-viewer-url="<%= @media_item.url %>">
  <div class="media-item -ml-12">
    <%= render 'media_icon', media_item: @media_item %>

    <div class="media-text">
      <h2 class="page-header mb-0" title="<%= @media_item.url %>">
        <%= @media_item.title_or_url %>
      </h1>

      <div class="toolbar text-muted mb-0">
        <div class="small media-item">
          <i class="fas fa-inbox fa-lg"></i>
          <%= link_to @media_item.queue.name, queue_path(@media_item.queue), class: 'text-muted' %>
        </div>

        <% if @media_item.estimated_consumption_time %>
          <div class="small media-item">
            <i class="far fa-clock fa-lg"></i>
            <%= pluralize @media_item.estimated_consumption_time, 'minute' %>
          </div>
        <% end %>

        <% if @media_item.priority %>
          <div class="small media-item">
            <i class="far fa-flag fa-lg"></i>
            <%= @media_item.priority.title %>
          </div>
        <% end %>

        <% if @media_item.consumption_difficulty %>
          <div class="small media-item">
            <i class="fas fa-sliders-h fa-lg text-muted"></i>
            <span class="<%= consumption_difficulty_classes(@media_item.consumption_difficulty) %>">
              <%= @media_item.consumption_difficulty.capitalize %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="toolbar mt-4">
    <div class="button-group">
      <%= link_to 'Edit', edit_media_item_path(@media_item), class: 'button' %>
      <%= button_to 'Mark Completed', complete_media_item_url(@media_item),
                    class: 'button',
                    method: :post,
                    disabled: @media_item.complete? %>
    </div>
    <div class="button-group">
      <%= external_link_to 'Open Media', @media_item.url, class: 'button', icon_position: :left %>
      <%= button_tag 'Open Viewer',
                    class: 'button',
                    data: { action: 'click->media-viewer#open' } %>
    </div>
  </div>

  <h3 class="section-header">Notes</h3>

  <div class="row">
    <div id="notes" class="column md4 pl-0">
      <%= form_with scope: :media_note,
                    url: media_item_notes_path(@media_item, format: :js) do |f| %>
        <%= f.text_field :title, placeholder: 'Title...' %>
        <div data-controller="rich-editor"
             data-rich-editor-input-name="media_note[content]"></div>
        <%= f.submit class: 'button' %>
      <% end %>

      <% if @media_item.notes.any? %>
        <% @media_item.notes.each do |note| %>
          <%= render 'note', note: note %>
        <% end %>
      <% end %>
    </div>
  </div>


  <div data-target="media-viewer.viewerWrap"
       class="sidebar hidden"></div>
</div>
